<!-- Блок индикации прогресса индексации -->
{% if application.status == 'indexing' %}
<div class="indexing-progress-container" id="indexing-progress-container">
    <h3>Индексация документа</h3>
    <div class="progress">
        <div id="indexing-progress" class="progress-bar progress-bar-striped progress-bar-animated"
             role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
    </div>
    <p id="status-message">Выполняется индексация документа. Пожалуйста, подождите...</p>

    <div class="horizontal-stages-container">
        <div class="horizontal-stages">
            <div class="stage" id="stage-prepare">
                <span class="stage-dot"></span>
                <span class="stage-label">Подготовка</span>
            </div>
            <div class="stage" id="stage-convert">
                <span class="stage-dot"></span>
                <span class="stage-label">Конвертация</span>
            </div>
            <div class="stage" id="stage-split">
                <span class="stage-dot"></span>
                <span class="stage-label">Разделение</span>
            </div>
            <div class="stage" id="stage-index">
                <span class="stage-dot"></span>
                <span class="stage-label">Индексация</span>
            </div>
            <div class="stage" id="stage-complete">
                <span class="stage-dot"></span>
                <span class="stage-label">Завершение</span>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Инициализация трекера индексации для заявки {{ application.id }}");

        // Создаем экземпляр трекера прогресса для индексации
        const indexingTracker = new TaskProgressTracker({
            statusUrl: "/applications/{{ application.id }}/status",
            progressBarId: "indexing-progress",
            statusMessageId: "status-message",
            progressContainerId: "indexing-progress-container",
            stagePrefix: "stage-",
            stages: ["prepare", "convert", "split", "index", "complete"],
            onComplete: function(data) {
                // При завершении просто перезагружаем страницу
                console.log("Индексация завершена, перезагрузка страницы...");
                window.location.reload();
            },
            checkInterval: 2000
        });

        // Начинаем отслеживание
        indexingTracker.startTracking("{{ application.id }}");
    });
</script>
{% endif %}

<!-- Блок индикации прогресса анализа -->
{% if application.status == 'analyzing' %}
<div class="analyzing-progress-container" id="analyzing-progress-container">
    <h3>Анализ документа</h3>
    <div class="progress">
        <div id="analyzing-progress" class="progress-bar progress-bar-striped progress-bar-animated"
             role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
    </div>
    <p id="analyzing-status-message">Выполняется анализ документа. Пожалуйста, подождите...</p>

    <div class="horizontal-stages-container">
        <div class="horizontal-stages">
            <div class="stage" id="analyzing-stage-prepare">
                <span class="stage-dot"></span>
                <span class="stage-label">Подготовка</span>
            </div>
            <div class="stage" id="analyzing-stage-analyze">
                <span class="stage-dot"></span>
                <span class="stage-label">Анализ</span>
            </div>
            <div class="stage" id="analyzing-stage-complete">
                <span class="stage-dot"></span>
                <span class="stage-label">Завершение</span>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Инициализация трекера анализа для заявки {{ application.id }}");

        // Создаем экземпляр трекера прогресса для анализа
        const analyzingTracker = new TaskProgressTracker({
            statusUrl: "/applications/{{ application.id }}/status",
            progressBarId: "analyzing-progress",
            statusMessageId: "analyzing-status-message",
            progressContainerId: "analyzing-progress-container",
            stagePrefix: "analyzing-stage-",
            stages: ["prepare", "analyze", "complete"],
            onComplete: function(data) {
                // При завершении просто перезагружаем страницу
                console.log("Анализ завершен, перезагрузка страницы...");
                window.location.reload();
            },
            checkInterval: 2000
        });

        // Начинаем отслеживание
        analyzingTracker.startTracking("{{ application.id }}");
    });
</script>
{% endif %}